version: "3.9"

services:
  access:
    image: golang:1.21
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "cd src/go && go run ./services/access"
    environment:
      SERVICE_PORT: "8101"
    ports:
      - "8101:8101"

  orchestrator:
    image: python:3.11-slim
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "pip install -e . && uvicorn services.orchestrator.main:app --host 0.0.0.0 --port $${SERVICE_PORT}"
    environment:
      SERVICE_PORT: "8001"
    ports:
      - "8001:8001"

  model_gateway:
    image: python:3.11-slim
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "pip install -e . && uvicorn services.model_gateway.main:app --host 0.0.0.0 --port $${SERVICE_PORT}"
    environment:
      SERVICE_PORT: "8002"
    ports:
      - "8002:8002"

  tools:
    image: python:3.11-slim
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "pip install -e . && uvicorn services.tools.main:app --host 0.0.0.0 --port $${SERVICE_PORT}"
    environment:
      SERVICE_PORT: "8003"
    ports:
      - "8003:8003"

  knowledge:
    image: python:3.11-slim
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "pip install -e . && uvicorn services.knowledge.main:app --host 0.0.0.0 --port $${SERVICE_PORT}"
    environment:
      SERVICE_PORT: "8004"
    ports:
      - "8004:8004"

  governance:
    image: golang:1.21
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "cd src/go && go run ./services/governance"
    environment:
      SERVICE_PORT: "8102"
    ports:
      - "8102:8102"

  observability:
    image: golang:1.21
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "cd src/go && go run ./services/observability"
    environment:
      SERVICE_PORT: "8103"
    ports:
      - "8103:8103"
